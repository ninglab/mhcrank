/fs/scratch/PCON0041/PatrickLawrence/mhcrank-debug/mhc_rank/amino_acid.py:126: FutureWarning: The frame.append method is deprecated and will be removed from pandas in a future version. Use pandas.concat instead.
  "PC_blosum": PC.append(blosum_normalized, ignore_index=True)  # encode blosum PC combo
2023-05-25 17:43:53.415 INFO class1_processing_predictor - load: Loaded 0 class1 processing models
To show stack trace, run:
kill -s USR1 56182
Arguments:
Namespace(continue_incomplete=True, data=None, debug=False, held_out_samples=10, hyperparameters=None, max_epochs=None, num_folds=4, num_replicates=1, only_initialize=False, out_models_dir='./output/', pre_folded=None, verbosity=0)
Beginning training.
Loaded predictor with 0 networks
Loaded training init info.
Found 4 work items, of which 4 are incomplete and will run now.
Processing 4 work items in serial.
  0%|          | 0/4 [00:00<?, ?it/s]2023-05-25 17:44:00.299836: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-05-25 17:44:00.620146: E tensorflow/stream_executor/cuda/cuda_driver.cc:271] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected
2023-05-25 17:44:00.620284: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (p0076.ten.osc.edu): /proc/driver/nvidia/version does not exist
2023-05-25 17:44:00.622 WARNING deprecation - new_func: From /users/PAS1475/lawrencep487/.conda/envs/tf-gpu/lib/python3.8/site-packages/tensorflow/python/compat/v2_compat.py:107: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.
Instructions for updating:
non-resource variables are not supported in the long term
2023-05-25 17:44:00.974 WARNING module_wrapper - _tfmw_add_deprecation_warning: From /fs/scratch/PCON0041/PatrickLawrence/mhcrank-debug/mhc_rank/common.py:72: The name tf.keras.backend.set_session is deprecated. Please use tf.compat.v1.keras.backend.set_session instead.

2023-05-25 17:44:00.988 WARNING deprecation - new_func: From /users/PAS1475/lawrencep487/.conda/envs/tf-gpu/lib/python3.8/site-packages/keras/initializers/initializers_v1.py:277: calling RandomUniform.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
{'work_item_name': '3a6b6cae-8d1c-440d-b990-41de46e79daa', 'architecture_num': 0, 'num_architectures': 1, 'fold_num': 3, 'num_folds': 4, 'replicate_num': 0, 'num_replicates': 1, 'hyperparameters': {'amino_acid_encoding': 'BLOSUM62', 'learn_embedding': 'yes', 'learned_embed_dims': 21, 'peptide_max_length': 9, 'n_flank_length': 5, 'c_flank_length': 5, 'cleave_radius': 3, 'convolutional_filters': 128, 'convolutional_kernel_size': 9, 'convolutional_activation': 'relu', 'convolutional_kernel_l1_l2': [0.0, 0.0], 'post_convolutional_dense_layer_sizes': 32, 'dropout_rate': 0.5, 'loss_function': 'binary_crossentropy', 'optimizer': 'adam'}, 'work_item_num': 0, 'num_work_items': 4, 'progress_print_interval': 5.0, 'predictor': <Class1ProcessingPredictor at 0x2ad4c24754c0 [mhcflurry 1.0.0] generated on Thu May 25 17:34:32 2023>, 'save_to': '/fs/scratch/PCON0041/PatrickLawrence/mhcrank-debug/output', 'verbose': 0}
Training on 358374 points (41018 points held-out).
[task  1 /  4]: [ 4 /  4 folds] [ 1 /  1 architectures] [   1 /    1 replicates]  [pid 56182]. Hyperparameters:
{'amino_acid_encoding': 'BLOSUM62',
 'c_flank_length': 5,
 'cleave_radius': 3,
 'convolutional_activation': 'relu',
 'convolutional_filters': 128,
 'convolutional_kernel_l1_l2': [0.0, 0.0],
 'convolutional_kernel_size': 9,
 'dropout_rate': 0.5,
 'learn_embedding': 'yes',
 'learned_embed_dims': 21,
 'loss_function': 'binary_crossentropy',
 'n_flank_length': 5,
 'optimizer': 'adam',
 'peptide_max_length': 9,
 'post_convolutional_dense_layer_sizes': 32}
Making empty net
Forcing tensorflow backend.
Model: "predictor"
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 sequence (InputLayer)          [(None, 19)]         0           []                               
                                                                                                  
 embedding (Embedding)          (None, 19, 21)       441         ['sequence[0][0]']               
                                                                                                  
 conv1 (Conv1D)                 (None, 19, 128)      24320       ['embedding[0][0]']              
                                                                                                  
 conv1_dropout (Dropout)        (None, 19, 128)      0           ['conv1[0][0]']                  
                                                                                                  
 n_flank_post_0 (Conv1D)        (None, 19, 32)       4128        ['conv1_dropout[0][0]']          
                                                                                                  
 c_flank_post_0 (Conv1D)        (None, 19, 32)       4128        ['conv1_dropout[0][0]']          
                                                                                                  
 n_flank_post_1 (Conv1D)        (None, 19, 1)        33          ['n_flank_post_0[0][0]']         
                                                                                                  
 c_flank_post_1 (Conv1D)        (None, 19, 1)        33          ['c_flank_post_0[0][0]']         
                                                                                                  
 tf_op_layer_n_flank_internal_c  [(None, 19, 1)]     0           ['n_flank_post_1[0][0]']         
 leaved/add_1 (TensorFlowOpLaye                                                                   
 r)                                                                                               
                                                                                                  
 tf_op_layer_n_flank_extracted/  [(None, 19, 128)]   0           ['conv1_dropout[0][0]']          
 add (TensorFlowOpLayer)                                                                          
                                                                                                  
 tf_op_layer_c_flank_internal_c  [(None, 19, 1)]     0           ['c_flank_post_1[0][0]']         
 leaved/add_1 (TensorFlowOpLaye                                                                   
 r)                                                                                               
                                                                                                  
 tf_op_layer_c_flank_extracted/  [(None, 19, 128)]   0           ['conv1_dropout[0][0]']          
 add_3 (TensorFlowOpLayer)                                                                        
                                                                                                  
 tf_op_layer_n_flank_internal_c  [(None, 19, 1)]     0           ['tf_op_layer_n_flank_internal_cl
 leaved/mul (TensorFlowOpLayer)                                  eaved/add_1[0][0]']              
                                                                                                  
 tf_op_layer_n_flank_extracted/  [(None, 19, 128)]   0           ['tf_op_layer_n_flank_extracted/a
 mul (TensorFlowOpLayer)                                         dd[0][0]']                       
                                                                                                  
 tf_op_layer_c_flank_internal_c  [(None, 19, 1)]     0           ['tf_op_layer_c_flank_internal_cl
 leaved/mul (TensorFlowOpLayer)                                  eaved/add_1[0][0]']              
                                                                                                  
 tf_op_layer_c_flank_extracted/  [(None, 19, 128)]   0           ['tf_op_layer_c_flank_extracted/a
 mul (TensorFlowOpLayer)                                         dd_3[0][0]']                     
                                                                                                  
 cleave_site (InputLayer)       [(None, 6)]          0           []                               
                                                                                                  
 tf_op_layer_n_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_n_flank_internal_cl
 leaved/Max (TensorFlowOpLayer)                                  eaved/mul[0][0]']                
                                                                                                  
 tf_op_layer_n_flank_extracted/  [(None, 128)]       0           ['tf_op_layer_n_flank_extracted/m
 Mean (TensorFlowOpLayer)                                        ul[0][0]']                       
                                                                                                  
 tf_op_layer_c_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_c_flank_internal_cl
 leaved/Max (TensorFlowOpLayer)                                  eaved/mul[0][0]']                
                                                                                                  
 tf_op_layer_c_flank_extracted/  [(None, 128)]       0           ['tf_op_layer_c_flank_extracted/m
 Mean (TensorFlowOpLayer)                                        ul[0][0]']                       
                                                                                                  
 embedding_1 (Embedding)        (None, 6, 21)        441         ['cleave_site[0][0]']            
                                                                                                  
 tf_op_layer_n_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_n_flank_internal_cl
 leaved/sub (TensorFlowOpLayer)                                  eaved/Max[0][0]']                
                                                                                                  
 tf_op_layer_n_flank_extracted/  [(None, 128)]       0           ['tf_op_layer_n_flank_extracted/M
 sub (TensorFlowOpLayer)                                         ean[0][0]']                      
                                                                                                  
 tf_op_layer_c_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_c_flank_internal_cl
 leaved/sub_1 (TensorFlowOpLaye                                  eaved/Max[0][0]']                
 r)                                                                                               
                                                                                                  
 tf_op_layer_c_flank_extracted/  [(None, 128)]       0           ['tf_op_layer_c_flank_extracted/M
 sub (TensorFlowOpLayer)                                         ean[0][0]']                      
                                                                                                  
 peptide_length (InputLayer)    [(None, 1)]          0           []                               
                                                                                                  
 global_kernel (GlobalMaxPoolin  (None, 21)          0           ['embedding_1[0][0]']            
 g1D)                                                                                             
                                                                                                  
 n_flank_cleaved (Lambda)       (None, 1)            0           ['n_flank_post_1[0][0]']         
                                                                                                  
 tf_op_layer_n_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_n_flank_internal_cl
 leaved/mul_1 (TensorFlowOpLaye                                  eaved/sub[0][0]']                
 r)                                                                                               
                                                                                                  
 n_flank_avg_dense (Dense)      (None, 1)            129         ['tf_op_layer_n_flank_extracted/s
                                                                 ub[0][0]']                       
                                                                                                  
 c_flank_cleaved (Lambda)       (None, 1)            0           ['c_flank_post_1[0][0]']         
                                                                                                  
 tf_op_layer_c_flank_internal_c  [(None, 1)]         0           ['tf_op_layer_c_flank_internal_cl
 leaved/mul_1 (TensorFlowOpLaye                                  eaved/sub_1[0][0]']              
 r)                                                                                               
                                                                                                  
 c_flank_avg_dense (Dense)      (None, 1)            129         ['tf_op_layer_c_flank_extracted/s
                                                                 ub[0][0]']                       
                                                                                                  
 peptide_length_dense (Dense)   (None, 1)            2           ['peptide_length[0][0]']         
                                                                                                  
 final (Concatenate)            (None, 28)           0           ['global_kernel[0][0]',          
                                                                  'n_flank_cleaved[0][0]',        
                                                                  'tf_op_layer_n_flank_internal_cl
                                                                 eaved/mul_1[0][0]',              
                                                                  'n_flank_avg_dense[0][0]',      
                                                                  'c_flank_cleaved[0][0]',        
                                                                  'tf_op_layer_c_flank_internal_cl
                                                                 eaved/mul_1[0][0]',              
                                                                  'c_flank_avg_dense[0][0]',      
                                                                  'peptide_length_dense[0][0]']   
                                                                                                  
 output_dense1 (Dense)          (None, 32)           928         ['final[0][0]']                  
                                                                                                  
 output_dropout1 (Dropout)      (None, 32)           0           ['output_dense1[0][0]']          
                                                                                                  
 output_dense2 (Dense)          (None, 32)           1056        ['output_dropout1[0][0]']        
                                                                                                  
 output_dropout2 (Dropout)      (None, 32)           0           ['output_dense2[0][0]']          
                                                                                                  
 output_final (Dense)           (None, 1)            33          ['output_dropout2[0][0]']        
                                                                                                  
==================================================================================================
Total params: 35,801
Trainable params: 35,801
Non-trainable params: 0
__________________________________________________________________________________________________
